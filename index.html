<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controla Beta - Local</title>
    <style>
        :root {
            --bg: #000000;
            --card: #111111;
            --input: #1a1a1a;
            --accent: #ffffff;
            --danger: #ff4d4d;
            --success: #2ecc71;
            --text-secondary: #888;
        }

        body {
            margin: 0;
            background: var(--bg);
            color: white;
            font-family: 'Inter', -apple-system, sans-serif;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 450px;
            padding: 20px;
        }

        .card {
            background: var(--card);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        h1, h2, h3 { margin: 0 0 15px 0; }

        input, select {
            width: 100%;
            padding: 14px;
            margin: 8px 0;
            background: var(--input);
            border: 1px solid #222;
            border-radius: 12px;
            color: white;
            box-sizing: border-box;
        }

        button {
            width: 100%;
            padding: 14px;
            background: var(--accent);
            border: none;
            border-radius: 12px;
            color: black;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }

        button:hover { opacity: 0.8; }

        .btn-delete {
            background: #222;
            color: var(--danger);
            width: auto;
            padding: 5px 10px;
            margin: 0;
        }

        .saldoBox { text-align: center; padding: 30px 0; }
        .saldoBox p { font-size: 45px; font-weight: bold; margin: 10px 0; }

        ul { list-style: none; padding: 0; }

        li {
            background: var(--card);
            margin: 10px 0;
            padding: 15px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid transparent;
        }

        .item-ingreso { border-left-color: var(--success); }
        .item-gasto { border-left-color: var(--danger); }

        .progressBar { height: 8px; background: #222; border-radius: 10px; margin-top: 10px; overflow: hidden; }
        .progressFill { height: 100%; background: var(--success); transition: width 0.5s; }
    </style>
</head>
<body>

<div class="container">
    <header style="padding: 20px 0;">
        <h1>Controla Î²</h1>
        <p style="color: var(--text-secondary); font-size: 12px;">Modo Local (Sin Firebase)</p>
    </header>

    <section class="saldoBox">
        <h2 style="color: var(--text-secondary); font-size: 14px;">SALDO ACTUAL</h2>
        <p id="saldo">$0.00</p>
    </section>

    <div class="card">
        <h3>Nuevo Movimiento</h3>
        <select id="tipo">
            <option value="Ingreso">ðŸŸ¢ Ingreso</option>
            <option value="Gasto">ðŸ”´ Gasto</option>
        </select>
        <input id="cantidad" type="number" placeholder="Monto $">
        <input id="categoria" type="text" placeholder="Concepto (ej. Comida)">
        <button onclick="addMovimiento()">Guardar Registro</button>
    </div>

    <h3>Historial</h3>
    <ul id="historial"></ul>

    <div class="card" style="margin-top: 30px;">
        <h3>Meta de Ahorro</h3>
        <input id="metaNombre" placeholder="Â¿QuÃ© quieres comprar?">
        <input id="metaMonto" type="number" placeholder="Precio total $">
        <button onclick="addMeta()">Fijar Meta</button>
        <div id="metasContainer"></div>
    </div>
</div>

<script>
    // Variables de estado
    let movimientos = JSON.parse(localStorage.getItem('movimientos')) || [];
    let metas = JSON.parse(localStorage.getItem('metas')) || [];

    // FunciÃ³n para guardar y actualizar todo
    function updateApp() {
        localStorage.setItem('movimientos', JSON.stringify(movimientos));
        localStorage.setItem('metas', JSON.stringify(metas));
        renderData();
    }

    function addMovimiento() {
        const cantidad = parseFloat(document.getElementById('cantidad').value);
        const categoria = document.getElementById('categoria').value;
        const tipo = document.getElementById('tipo').value;

        if (!cantidad || !categoria) return alert("Llena todos los campos");

        movimientos.unshift({ id: Date.now(), tipo, cantidad, categoria });
        document.getElementById('cantidad').value = '';
        document.getElementById('categoria').value = '';
        updateApp();
    }

    function deleteMovimiento(id) {
        movimientos = movimientos.filter(m => m.id !== id);
        updateApp();
    }

    function addMeta() {
        const nombre = document.getElementById('metaNombre').value;
        const objetivo = parseFloat(document.getElementById('metaMonto').value);

        if (!nombre || !objetivo) return alert("Ponle nombre y precio a tu meta");

        metas = [{ nombre, objetivo }]; // Una meta a la vez para simplificar
        updateApp();
    }

    function renderData() {
        let saldoTotal = 0;
        const historialUI = document.getElementById('historial');
        historialUI.innerHTML = '';

        movimientos.forEach(m => {
            const esIngreso = m.tipo === "Ingreso";
            saldoTotal += esIngreso ? m.cantidad : -m.cantidad;

            const li = document.createElement('li');
            li.className = esIngreso ? "item-ingreso" : "item-gasto";
            li.innerHTML = `
                <div>
                    <strong>${m.categoria}</strong><br>
                    <small style="color: grey">${m.tipo}</small>
                </div>
                <div style="text-align: right">
                    <b style="color: ${esIngreso ? 'var(--success)' : 'var(--danger)'}">
                        ${esIngreso ? '+' : '-'}$${m.cantidad.toFixed(2)}
                    </b><br>
                    <button class="btn-delete" onclick="deleteMovimiento(${m.id})">Borrar</button>
                </div>
            `;
            historialUI.appendChild(li);
        });

        document.getElementById('saldo').innerText = `$${saldoTotal.toLocaleString()}`;

        // Render Metas
        const metasUI = document.getElementById('metasContainer');
        metasUI.innerHTML = '';
        metas.forEach(meta => {
            const porcentaje = Math.max(0, Math.min((saldoTotal / meta.objetivo) * 100, 100));
            metasUI.innerHTML = `
                <div style="margin-top: 15px;">
                    <div style="display:flex; justify-content:space-between; font-size:14px">
                        <span>${meta.nombre}</span>
                        <span>${porcentaje.toFixed(0)}%</span>
                    </div>
                    <div class="progressBar">
                        <div class="progressFill" style="width: ${porcentaje}%"></div>
                    </div>
                    <p style="font-size: 11px; margin-top: 5px; color: #888">
                        Faltan $${Math.max(0, meta.objetivo - saldoTotal).toFixed(2)}
                    </p>
                </div>
            `;
        });
    }

    // Carga inicial
    renderData();
</script>

</body>
</html>
